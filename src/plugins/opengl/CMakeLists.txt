MACRO(
	ADD_SGE_OPENGL_SOURCE_GROUP
	SOURCEPATH
)
	ADD_SGE_SOURCE_GROUP(
		"src\\\\\\\\plugins\\\\\\\\opengl"
		""
		"${SOURCEPATH}"
		*.?pp
		TEMPFILES
	)

	SET(SGEOPENGLFILES ${SGEOPENGLFILES} ${TEMPFILES})
ENDMACRO()

ADD_SGE_OPENGL_SOURCE_GROUP("")
ADD_SGE_OPENGL_SOURCE_GROUP(context)
ADD_SGE_OPENGL_SOURCE_GROUP(context/src)
ADD_SGE_OPENGL_SOURCE_GROUP(convert)
ADD_SGE_OPENGL_SOURCE_GROUP(convert/src)
ADD_SGE_OPENGL_SOURCE_GROUP(glew)
ADD_SGE_OPENGL_SOURCE_GROUP(glew/src)
ADD_SGE_OPENGL_SOURCE_GROUP(glsl)
ADD_SGE_OPENGL_SOURCE_GROUP(glsl/arb)
ADD_SGE_OPENGL_SOURCE_GROUP(glsl/arb/src)
ADD_SGE_OPENGL_SOURCE_GROUP(glsl/native)
ADD_SGE_OPENGL_SOURCE_GROUP(glsl/native/src)
ADD_SGE_OPENGL_SOURCE_GROUP(glsl/programfuncs)
ADD_SGE_OPENGL_SOURCE_GROUP(glsl/programfuncs/src)
ADD_SGE_OPENGL_SOURCE_GROUP(glsl/shaderfuncs)
ADD_SGE_OPENGL_SOURCE_GROUP(glsl/shaderfuncs/src)
ADD_SGE_OPENGL_SOURCE_GROUP(glsl/src)
ADD_SGE_OPENGL_SOURCE_GROUP(glsl/uniform)
ADD_SGE_OPENGL_SOURCE_GROUP(glsl/uniform/src)
ADD_SGE_OPENGL_SOURCE_GROUP(src)
ADD_SGE_OPENGL_SOURCE_GROUP(texfuncs)
ADD_SGE_OPENGL_SOURCE_GROUP(texfuncs/src)
ADD_SGE_OPENGL_SOURCE_GROUP(vf)
ADD_SGE_OPENGL_SOURCE_GROUP(vf/src)

INCLUDE_DIRECTORIES(${OPENGL_INCLUDE_DIR})

FIND_PACKAGE(
	X11
	REQUIRED
)

IF (X11_FOUND)
	SET (SGE_OPENGL_HAVE_X11 TRUE)

	INCLUDE_DIRECTORIES(${X11_X11_INCLUDE})

	ADD_SGE_OPENGL_SOURCE_GROUP(glx)
	ADD_SGE_OPENGL_SOURCE_GROUP(glx/src)
	ADD_SGE_OPENGL_SOURCE_GROUP(x11)
	ADD_SGE_OPENGL_SOURCE_GROUP(x11/resolution)
	ADD_SGE_OPENGL_SOURCE_GROUP(x11/resolution/src)
	ADD_SGE_OPENGL_SOURCE_GROUP(x11/src)

	IF(X11_xf86vmode_FOUND)
		SET (SGE_OPENGL_HAVE_XF86VMODE TRUE)

		INCLUDE_DIRECTORIES(${X11_xf86vmode_INCLUDE_PATH})

		ADD_SGE_OPENGL_SOURCE_GROUP(xf86vmode)
		ADD_SGE_OPENGL_SOURCE_GROUP(xf86vmode/src)
	ENDIF()

	IF(X11_Xrandr_FOUND)
		SET (SGE_OPENGL_HAVE_XRANDR TRUE)

		INCLUDE_DIRECTORIES(${X11_Xrandr_INCLUDE_PATH})

		ADD_SGE_OPENGL_SOURCE_GROUP(xrandr)
		ADD_SGE_OPENGL_SOURCE_GROUP(xrandr/src)
	ENDIF()
ELSEIF (WIN32)
	ADD_SGE_OPENGL_SOURCE_GROUP(wgl)
	ADD_SGE_OPENGL_SOURCE_GROUP(wgl/src)
	ADD_SGE_OPENGL_SOURCE_GROUP(windows)
	ADD_SGE_OPENGL_SOURCE_GROUP(windows/src)
ENDIF ()

CONFIGURE_FILE(
	${CMAKE_CURRENT_SOURCE_DIR}/config.hpp.in
	${CMAKE_CURRENT_SOURCE_DIR}/config.hpp
)

INCLUDE_DIRECTORIES(${OPENGL_INCLUDE_DIR})

INCLUDE_DIRECTORIES(${GLEW_INCLUDE_PATH})

ADD_LIBRARY (sgeopengl SHARED ${SGEOPENGLFILES})

TARGET_LINK_LIBRARIES (
	sgeopengl
	sgecore
	${OPENGL_gl_LIBRARY}
	${GLEW_LIBRARY}
	${AWL_LIBRARY}
)

IF (X11_FOUND)
	TARGET_LINK_LIBRARIES (sgeopengl ${X11_LIBRARIES})

	IF(X11_xf86vmode_FOUND)
		# somehow this is not handled by FindX11
		FIND_LIBRARY(
			X11_xf86vmode_LIB
			NAMES Xxf86vm
		)

		TARGET_LINK_LIBRARIES(
			sgeopengl
			${X11_xf86vmode_LIB}
		)
	ENDIF()

	IF(X11_Xrandr_FOUND)
		TARGET_LINK_LIBRARIES(
			sgeopengl
			${X11_Xrandr_LIB}
		)
	ENDIF()
ENDIF ()

INSTALL (TARGETS sgeopengl DESTINATION lib/sge)
