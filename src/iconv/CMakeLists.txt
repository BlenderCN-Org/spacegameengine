FIND_PACKAGE(
	Iconv REQUIRED
)

IF(
	NOT ICONV_FOUND
)
	MESSAGE(
		FATAL_ERROR
		"Iconv has not been found but was enabled. It is possible to disable iconv but this is not recommended."
	)
ENDIF()

INCLUDE_DIRECTORIES(
	${ICONV_INCLUDE_DIR}
)

MACRO(
	ADD_SGE_ICONV_INCLUDE_SOURCE_GROUP
	SOURCEPATH
)
	ADD_SGE_SOURCE_GROUP(
		"include\\\\\\\\sge\\\\\\\\iconv" #cmake bitch
		${CMAKE_SOURCE_DIR}/include/sge/iconv
		"${SOURCEPATH}"
		*.hpp
		TEMPFILES
	)

	SET(SGEICONVFILES ${SGEICONVFILES} ${TEMPFILES})
ENDMACRO()

ADD_SGE_ICONV_INCLUDE_SOURCE_GROUP("")

MACRO(
	ADD_SGE_ICONV_SOURCE_GROUP
	SOURCEPATH
)
	ADD_SGE_SOURCE_GROUP(
		"src\\\\\\\\iconv"
		""
		"${SOURCEPATH}"
		*.?pp
		TEMPFILES	
	)

	SET(SGEICONVFILES ${SGEICONVFILES} ${TEMPFILES})
ENDMACRO()

ADD_SGE_ICONV_SOURCE_GROUP("")

ADD_LIBRARY (sgeiconv SHARED ${SGEICONVFILES})

TARGET_LINK_LIBRARIES (
	sgeiconv
	sgecore
)

IF(
	NOT ICONV_HAVE_POSIX
)
	TARGET_LINK_LIBRARIES(
		sgeiconv
		${ICONV_LIBRARY}
	)	
ENDIF()

INSTALL (TARGETS sgeiconv DESTINATION lib)

INSTALL(DIRECTORY ${CMAKE_SOURCE_DIR}/include/sge/iconv DESTINATION include/sge)
