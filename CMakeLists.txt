PROJECT (spacegameengine)

INCLUDE (CheckCXXSourceCompiles)
INCLUDE (OWGetGCCVersion.cmake)

SET (CMAKE_VERBOSE_MAKEFILE ON)
SET (CMAKE_ALLOW_LOOSE_LOOP_CONSTRUCTS ON)

SET (CMAKE_REQUIRED_FLAGS "-std=c++0x")
SET (CMAKE_REQUIRED_DEFINITIONS "")

CHECK_CXX_SOURCE_COMPILES(
	"template<typename... Args> void f(Args... args) {} int main(){}",
	SGE_HAVE_VARIADIC_TEMPLATES
)

IF (${CMAKE_COMPILER_IS_GNUCXX})
	ow_get_gcc_version (gccversion)

	SET (CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -ansi -pedantic -Wall -Wextra -Wconversion -Wfloat-equal")

	IF (${gccversion} STRGREATER "4.3.0" OR ${gccversion} STREQUAL "4.3.0")
		SET (CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wold-style-cast -std=c++0x")

		ADD_DEFINITIONS(-DSGE_HAVE_VARIADIC_TEMPLATES -DSGE_HAVE_STATIC_ASSERT)
	ENDIF ()
ELSEIF (${MSVC})
	SET (CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} /W4 /wd4512 /wd4355 /wd4800 /wd4996")
	SET (WINLIBS projects/windows/lib32)
	SET (WININCLUDES ${CMAKE_SOURCE_DIR}/${WINLIBS})

	INCLUDE_DIRECTORIES (${WININCLUDES}/libiconv/include)
	LINK_DIRECTORIES (${CMAKE_SOURCE_DIR}/${WINLIBS}/libiconv/lib)
ENDIF ()

IF (${ENABLE_NARROWSTRING})
	ADD_DEFINITIONS(-DSGE_NARROW_STRING=1)
ELSE ()
	ADD_DEFINITIONS (-DUNICODE=1 -D_UNICODE=1)
ENDIF ()

SET (pluginpath ${CMAKE_INSTALL_PREFIX}/lib/sge)
SET (include_dest ${CMAKE_INSTALL_PREFIX}/include/sge/)
SET (media_dest ${CMAKE_INSTALL_PREFIX}/share/games/sge/media/)

IF (ENABLE_DEBUG AND CMAKE_COMPILER_IS_GNUCXX)
	SET (CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -g -ggdb")
ENDIF ()


ADD_SUBDIRECTORY (src)
ADD_SUBDIRECTORY (3rdparty)

IF (${ENABLE_TEST})
	ADD_SUBDIRECTORY (test)
ENDIF ()

MACRO (INSTALL_MEDIA subpath)
	FILE (GLOB sgemedia media/${subpath}/*?.*)
	INSTALL (FILES ${sgemedia} DESTINATION ${media_dest}${subpath})
ENDMACRO ()

INSTALL_MEDIA (./)
INSTALL_MEDIA (fonts)
INSTALL_MEDIA (mainskin)
